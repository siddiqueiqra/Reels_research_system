<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reels Research System</title>
  <base target="_top">
  
  <!-- [Keep all your existing CSS styles exactly as they are - I'm not changing any CSS] -->
  <style>
    /* Copy all your existing styles from the original file */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-pink: #FF6B9D;
      --primary-peach: #FF8C61;
      --primary-purple: #9D4EDD;
      --primary-coral: #FF7B9C;
      --accent-rose: #FF5C8D;
      --accent-gold: #FFB347;
      --bg-base: #1A1625;
      --bg-soft: #241D2F;
      --bg-card: #2D2438;
      --bg-elevated: #372D44;
      --text-primary: #FFFFFF;
      --text-secondary: #E5E1EA;
      --text-tertiary: #B8B0C7;
      --text-muted: #8B7E9D;
      --white: #FFFFFF;
      --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.4);
      --shadow-medium: 0 16px 48px rgba(0, 0, 0, 0.5);
      --shadow-dreamy: 0 20px 60px rgba(157, 78, 221, 0.3);
      --shadow-glow: 0 0 30px rgba(255, 107, 157, 0.4);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, var(--bg-base) 0%, #1F1833 50%, var(--bg-soft) 100%);
      color: var(--text-primary);
      position: relative;
      overflow-x: hidden;
      font-size: 15px;
      line-height: 1.6;
      min-height: 100vh;
    }

    .bg-orbs {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      pointer-events: none;
    }

    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(100px);
      opacity: 0.3;
      animation: float 25s infinite ease-in-out;
      mix-blend-mode: screen;
    }

    .orb-1 {
      width: 700px;
      height: 700px;
      background: radial-gradient(circle, rgba(157, 78, 221, 0.4), rgba(255, 107, 157, 0.2));
      top: -250px;
      left: -250px;
      animation-delay: 0s;
    }

    .orb-2 {
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(255, 140, 97, 0.3), rgba(157, 78, 221, 0.2));
      bottom: -200px;
      right: -200px;
      animation-delay: 7s;
    }

    .orb-3 {
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(255, 92, 141, 0.3), rgba(255, 140, 97, 0.2));
      top: 40%;
      right: 15%;
      animation-delay: 14s;
    }

    .orb-4 {
      width: 450px;
      height: 450px;
      background: radial-gradient(circle, rgba(255, 179, 71, 0.3), rgba(157, 78, 221, 0.2));
      top: 60%;
      left: 10%;
      animation-delay: 21s;
    }

    @keyframes float {
      0%, 100% { 
        transform: translate(0, 0) scale(1);
        opacity: 0.3;
      }
      25% { 
        transform: translate(40px, -40px) scale(1.08);
        opacity: 0.4;
      }
      50% { 
        transform: translate(-30px, 30px) scale(0.92);
        opacity: 0.25;
      }
      75% { 
        transform: translate(30px, 40px) scale(1.05);
        opacity: 0.35;
      }
    }

    .login-page {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .login-container {
      background: rgba(45, 36, 56, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 32px;
      padding: 60px 50px;
      box-shadow: var(--shadow-dreamy);
      border: 1px solid rgba(157, 78, 221, 0.3);
      max-width: 450px;
      width: 100%;
      animation: fadeInUp 0.8s ease;
      position: relative;
      overflow: hidden;
    }

    .login-container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(157, 78, 221, 0.15), transparent);
      animation: rotate 30s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-header {
      text-align: center;
      margin-bottom: 40px;
      position: relative;
      z-index: 1;
    }

    .login-icon {
      font-size: 72px;
      margin-bottom: 20px;
      animation: pulse 3s ease-in-out infinite;
      filter: drop-shadow(0 4px 20px rgba(255, 107, 157, 0.6));
    }

    @keyframes pulse {
      0%, 100% { 
        transform: scale(1);
        filter: drop-shadow(0 4px 20px rgba(255, 107, 157, 0.6));
      }
      50% { 
        transform: scale(1.08);
        filter: drop-shadow(0 8px 30px rgba(157, 78, 221, 0.8));
      }
    }

    .login-title {
      font-size: 38px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary-pink), var(--accent-gold), var(--primary-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .login-subtitle {
      color: var(--text-tertiary);
      font-size: 14px;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid rgba(157, 78, 221, 0.3);
      border-radius: 16px;
      font-size: 15px;
      font-family: 'Inter', sans-serif;
      background: rgba(55, 45, 68, 0.8);
      transition: all 0.3s ease;
      color: var(--text-primary);
      font-weight: 600;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary-pink);
      box-shadow: 0 0 0 4px rgba(255, 107, 157, 0.2), var(--shadow-glow);
      background: var(--bg-elevated);
    }

    .form-input::placeholder {
      color: var(--text-muted);
      font-weight: 500;
    }

    .remember-me {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }

    .remember-me input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--primary-pink);
    }

    .remember-me label {
      font-size: 13px;
      color: var(--text-tertiary);
      cursor: pointer;
      font-weight: 600;
    }

    .btn-login {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
      color: var(--white);
      border: none;
      border-radius: 16px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-glow);
      position: relative;
      z-index: 1;
      letter-spacing: 0.3px;
    }

    .btn-login:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(255, 107, 157, 0.5), var(--shadow-glow);
    }

    .btn-login:active {
      transform: translateY(0);
    }

    .login-footer {
      text-align: center;
      margin-top: 32px;
      color: var(--text-tertiary);
      font-size: 13px;
      position: relative;
      z-index: 1;
      font-weight: 600;
    }

    .app-container {
      display: none;
      min-height: 100vh;
    }

    .app-container.active {
      display: block;
    }

    .app-header {
      background: rgba(45, 36, 56, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-bottom: 1px solid rgba(157, 78, 221, 0.3);
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-soft);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .app-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .app-logo-icon {
      font-size: 32px;
      filter: drop-shadow(0 2px 8px rgba(255, 107, 157, 0.5));
    }

    .app-logo-text {
      font-size: 24px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary-pink), var(--accent-gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    .app-user {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 16px;
      background: rgba(157, 78, 221, 0.2);
      border-radius: 20px;
      transition: all 0.3s ease;
      border: 1px solid rgba(157, 78, 221, 0.3);
    }

    .user-info:hover {
      background: rgba(157, 78, 221, 0.3);
      box-shadow: var(--shadow-glow);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white);
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(255, 107, 157, 0.4);
    }

    .user-name {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .btn-logout {
      padding: 10px 20px;
      background: linear-gradient(135deg, #FF5C5C, #FF8C61);
      color: var(--white);
      border: none;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(255, 92, 92, 0.4);
    }

    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 92, 92, 0.5);
    }

    .app-nav {
      background: rgba(45, 36, 56, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-bottom: 1px solid rgba(157, 78, 221, 0.3);
      padding: 0 40px;
      display: flex;
      gap: 8px;
    }

    .nav-item {
      padding: 16px 24px;
      background: transparent;
      border: none;
      color: var(--text-tertiary);
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
    }

    .nav-item:hover {
      color: var(--text-primary);
      background: rgba(157, 78, 221, 0.15);
    }

    .nav-item.active {
      color: var(--primary-pink);
      border-bottom-color: var(--primary-pink);
      background: rgba(255, 107, 157, 0.15);
      box-shadow: 0 2px 12px rgba(255, 107, 157, 0.3);
    }

    .app-main {
      padding: 40px;
      max-width: 1600px;
      margin: 0 auto;
    }

    .page-section {
      display: none;
      animation: fadeIn 0.6s ease;
    }

    .page-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: rgba(45, 36, 56, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 24px;
      padding: 32px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(157, 78, 221, 0.3);
      transition: all 0.3s ease;
      animation: fadeInUp 0.6s ease backwards;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(255, 107, 157, 0.2), transparent);
      border-radius: 50%;
    }

    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; }
    .stat-card:nth-child(3) { animation-delay: 0.3s; }
    .stat-card:nth-child(4) { animation-delay: 0.4s; }

    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-dreamy);
      border-color: var(--primary-pink);
    }

    .stat-icon {
      font-size: 40px;
      margin-bottom: 16px;
      filter: drop-shadow(0 4px 12px rgba(255, 107, 157, 0.5));
      position: relative;
      z-index: 1;
    }

    .stat-value {
      font-size: 48px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary-pink), var(--accent-gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
      letter-spacing: -1px;
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-tertiary);
      font-weight: 700;
      position: relative;
      z-index: 1;
    }

    .action-buttons {
      display: flex;
      gap: 16px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: 'Inter', sans-serif;
      letter-spacing: 0.3px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
      color: var(--white);
      box-shadow: var(--shadow-glow);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(255, 107, 157, 0.6);
    }

    .btn-secondary {
      background: rgba(157, 78, 221, 0.2);
      color: var(--primary-pink);
      border: 2px solid rgba(157, 78, 221, 0.4);
    }

    .btn-secondary:hover {
      background: rgba(157, 78, 221, 0.3);
      transform: translateY(-2px);
      box-shadow: var(--shadow-glow);
    }

    .activity-feed {
      background: rgba(45, 36, 56, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 24px;
      padding: 32px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(157, 78, 221, 0.3);
    }

    .section-title {
      font-size: 32px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      letter-spacing: -0.5px;
    }

    .activity-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
    }

    .activity-item:hover {
      background: rgba(157, 78, 221, 0.15);
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white);
      font-size: 18px;
      box-shadow: 0 4px 12px rgba(255, 107, 157, 0.4);
    }

    .activity-content {
      flex: 1;
    }

    .activity-text {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 4px;
      font-weight: 600;
    }

    .activity-time {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 600;
    }

    .research-form {
      background: rgba(45, 36, 56, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(157, 78, 221, 0.3);
      margin-bottom: 32px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 24px;
    }

    .form-group-full {
      grid-column: 1 / -1;
    }

    textarea.form-input {
      min-height: 120px;
      resize: vertical;
      font-family: 'Inter', sans-serif;
    }

    .file-upload {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }

    .file-upload-label {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 40px;
      border: 2px dashed rgba(157, 78, 221, 0.4);
      border-radius: 16px;
      background: rgba(157, 78, 221, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .file-upload-label:hover {
      border-color: var(--primary-pink);
      background: rgba(255, 107, 157, 0.15);
      box-shadow: var(--shadow-glow);
    }

    .file-upload input[type="file"] {
      position: absolute;
      opacity: 0;
      cursor: pointer;
    }

    .file-upload-icon {
      font-size: 32px;
    }

    .file-upload-text {
      font-size: 14px;
      color: var(--text-tertiary);
      font-weight: 600;
    }

    .table-container {
      background: rgba(45, 36, 56, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 24px;
      padding: 32px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(157, 78, 221, 0.3);
      overflow: hidden;
    }

    .table-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .search-box {
      position: relative;
      flex: 1;
      min-width: 300px;
      max-width: 500px;
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }

    .search-box input {
      width: 100%;
      padding: 12px 16px 12px 44px;
    }

    .table-wrapper {
      overflow-x: auto;
      border-radius: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1000px;
    }

    thead {
      background: linear-gradient(135deg, rgba(157, 78, 221, 0.2), rgba(255, 107, 157, 0.2));
    }

    th {
      padding: 16px;
      text-align: left;
      font-weight: 700;
      font-size: 13px;
      color: var(--text-primary);
      white-space: nowrap;
      letter-spacing: 0.3px;
    }

    tbody tr {
      border-bottom: 1px solid rgba(157, 78, 221, 0.2);
      transition: all 0.3s ease;
    }

    tbody tr:hover {
      background: rgba(157, 78, 221, 0.15);
    }

    tbody tr[data-outlier="Hook"] {
      background: linear-gradient(90deg, rgba(255, 107, 157, 0.1), transparent);
    }

    tbody tr[data-outlier="Music"] {
      background: linear-gradient(90deg, rgba(255, 140, 97, 0.1), transparent);
    }

    tbody tr[data-outlier="Script"] {
      background: linear-gradient(90deg, rgba(157, 78, 221, 0.1), transparent);
    }

    tbody tr[data-outlier="Shooting Style"] {
      background: linear-gradient(90deg, rgba(255, 179, 71, 0.1), transparent);
    }

    tbody tr[data-outlier="Full Reel"] {
      background: linear-gradient(90deg, rgba(255, 123, 156, 0.1), transparent);
    }

    tbody tr[data-outlier="Topic"] {
      background: linear-gradient(90deg, rgba(255, 179, 71, 0.1), transparent);
    }

    td {
      padding: 16px;
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .outlier-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      white-space: nowrap;
      letter-spacing: 0.3px;
    }

    .outlier-hook { background: rgba(255, 107, 157, 0.25); color: #FFB5D8; }
    .outlier-music { background: rgba(255, 140, 97, 0.25); color: #FFB396; }
    .outlier-script { background: rgba(157, 78, 221, 0.25); color: #C9A7E8; }
    .outlier-shooting { background: rgba(255, 179, 71, 0.25); color: #FFD08C; }
    .outlier-shootingstyle { background: rgba(255, 179, 71, 0.25); color: #FFD08C; }
    .outlier-full { background: rgba(255, 123, 156, 0.25); color: #FFAAC9; }
    .outlier-fullreel { background: rgba(255, 123, 156, 0.25); color: #FFAAC9; }
    .outlier-topic { background: rgba(255, 179, 71, 0.25); color: #FFD08C; }

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.3px;
    }

    .status-pending { background: rgba(255, 179, 71, 0.3); color: #FFD08C; }
    .status-approved { background: rgba(76, 175, 80, 0.3); color: #A5D6A7; }
    .status-rejected { background: rgba(244, 67, 54, 0.3); color: #EF9A9A; }
    .status-draft { background: rgba(139, 126, 157, 0.3); color: #B8B0C7; }
    .status-scripting { background: rgba(255, 179, 71, 0.3); color: #FFD08C; }
    .status-readytofilm { background: rgba(157, 78, 221, 0.3); color: #C9A7E8; }
    .status-filming { background: rgba(255, 107, 157, 0.3); color: #FFB5D8; }
    .status-editing { background: rgba(255, 140, 97, 0.3); color: #FFB396; }
    .status-review { background: rgba(255, 179, 71, 0.3); color: #FFD08C; }
    .status-readytopublish { background: rgba(76, 175, 80, 0.3); color: #A5D6A7; }
    .status-published { background: rgba(76, 175, 80, 0.4); color: #C8E6C9; }
    .status-needsrevision { background: rgba(244, 67, 54, 0.3); color: #EF9A9A; }

    .btn-icon {
      padding: 8px 16px;
      border: none;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 8px;
    }

    .btn-view {
      background: rgba(255, 140, 97, 0.25);
      color: #FFB396;
    }

    .btn-view:hover {
      background: rgba(255, 140, 97, 0.4);
      transform: scale(1.05);
    }

    .btn-edit {
      background: rgba(255, 107, 157, 0.25);
      color: #FFB5D8;
    }

    .btn-edit:hover {
      background: rgba(255, 107, 157, 0.4);
      transform: scale(1.05);
    }

    .btn-delete {
      background: rgba(244, 67, 54, 0.25);
      color: #EF9A9A;
    }

    .btn-delete:hover {
      background: rgba(244, 67, 54, 0.4);
      transform: scale(1.05);
    }

    .btn-refresh {
      background: rgba(157, 78, 221, 0.25);
      color: #C9A7E8;
    }

    .btn-refresh:hover {
      background: rgba(157, 78, 221, 0.4);
      transform: scale(1.05);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(26, 22, 37, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 1000;
      overflow-y: auto;
      padding: 40px 20px;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: rgba(45, 36, 56, 0.98);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 32px;
      max-width: 1200px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-dreamy);
      animation: slideInUp 0.4s ease;
      border: 1px solid rgba(157, 78, 221, 0.3);
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
      color: var(--white);
      padding: 32px 40px;
      border-radius: 32px 32px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: -0.5px;
    }

    .btn-close {
      background: rgba(255, 255, 255, 0.25);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      color: var(--white);
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 300;
    }

    .btn-close:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 40px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      border-bottom: 2px solid rgba(157, 78, 221, 0.3);
      margin-bottom: 32px;
      overflow-x: auto;
    }

    .tab {
      padding: 14px 24px;
      background: transparent;
      border: none;
      color: var(--text-tertiary);
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .tab:hover {
      color: var(--text-primary);
      background: rgba(157, 78, 221, 0.15);
    }

    .tab.active {
      color: var(--primary-pink);
      border-bottom-color: var(--primary-pink);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
    }

    .empty-icon {
      font-size: 80px;
      opacity: 0.3;
      margin-bottom: 24px;
      filter: drop-shadow(0 4px 12px rgba(255, 107, 157, 0.3));
    }

    .empty-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
      letter-spacing: -0.5px;
    }

    .empty-text {
      font-size: 14px;
      color: var(--text-tertiary);
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .app-header {
        padding: 16px 20px;
      }

      .app-nav {
        padding: 0 20px;
        overflow-x: auto;
      }

      .app-main {
        padding: 24px 20px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .table-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .search-box {
        max-width: 100%;
      }

      .login-container {
        padding: 40px 30px;
      }
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
    }

    .spinner {
      width: 60px;
      height: 60px;
      margin: 0 auto 24px;
      border: 4px solid rgba(157, 78, 221, 0.3);
      border-top: 4px solid var(--primary-pink);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 14px;
      color: var(--text-tertiary);
      font-weight: 600;
    }

    .message {
      padding: 16px 24px;
      border-radius: 16px;
      margin-bottom: 24px;
      display: none;
      animation: slideInDown 0.4s ease;
      font-weight: 700;
    }

    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.active {
      display: block;
    }

    .message.success {
      background: rgba(76, 175, 80, 0.3);
      color: #A5D6A7;
      border: 2px solid rgba(76, 175, 80, 0.5);
    }

    .message.error {
      background: rgba(244, 67, 54, 0.3);
      color: #EF9A9A;
      border: 2px solid rgba(244, 67, 54, 0.5);
    }

    .message.info {
      background: rgba(255, 179, 71, 0.3);
      color: #FFD08C;
      border: 2px solid rgba(255, 179, 71, 0.5);
    }

    ::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(26, 22, 37, 0.5);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, var(--accent-rose), var(--primary-pink));
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
    }

    .dashboard-card {
      background: rgba(45, 36, 56, 0.95);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 24px;
      padding: 32px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(157, 78, 221, 0.3);
    }

    .chart-container {
      margin-top: 24px;
    }

    .bar-chart {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .bar-item {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .bar-label {
      min-width: 120px;
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 700;
    }

    .bar-track {
      flex: 1;
      height: 32px;
      background: rgba(157, 78, 221, 0.2);
      border-radius: 16px;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-pink), var(--primary-purple));
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 12px;
      color: var(--white);
      font-size: 12px;
      font-weight: 700;
      transition: width 1s ease;
    }

    .top-list {
      list-style: none;
    }

    .top-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 12px;
      background: rgba(157, 78, 221, 0.15);
    }

    .top-list-rank {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple));
      color: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      margin-right: 16px;
      box-shadow: 0 4px 12px rgba(255, 107, 157, 0.4);
    }

    .top-list-content {
      flex: 1;
    }

    .top-list-text {
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 600;
    }

    .top-list-count {
      font-size: 12px;
      color: var(--text-tertiary);
      padding: 4px 12px;
      background: rgba(157, 78, 221, 0.2);
      border-radius: 12px;
      font-weight: 700;
    }
  </style>
</head>

<body>
  <div class="bg-orbs">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
  </div>

  <!-- Login Page -->
  <div class="login-page" id="loginPage">
    <div class="login-container">
      <div class="login-header">
        <div class="login-icon">üé¨</div>
        <h1 class="login-title">REELS RESEARCH</h1>
        <p class="login-subtitle">Content Research System</p>
      </div>

      <form id="loginForm">
        <div class="form-group">
          <label class="form-label">Username</label>
          <input type="text" class="form-input" id="username" placeholder="Enter username" required>
        </div>

        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="password" placeholder="Enter password" required>
        </div>

        <div class="remember-me">
          <input type="checkbox" id="rememberMe">
          <label for="rememberMe">Remember me</label>
        </div>

        <button type="submit" class="btn-login" id="loginBtn">Login</button>
      </form>

      <div style="margin-top: 24px; text-align: center; color: var(--text-muted); font-size: 13px;">
        Welcome Content Creator
      </div>
    </div>
  </div>

  <!-- Main App -->
  <div class="app-container" id="appContainer">
    <header class="app-header">
      <div class="app-logo">
        <span class="app-logo-icon">üé¨</span>
        <span class="app-logo-text">Reels Research Hub</span>
      </div>

      <div class="app-user">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <span class="user-name" id="userName">User</span>
        </div>
        <button class="btn-logout" id="logoutBtn">Logout</button>
      </div>
    </header>

    <nav class="app-nav">
      <button class="nav-item active" data-page="dashboard">Dashboard</button>
      <button class="nav-item" data-page="research">Research</button>
      <button class="nav-item" data-page="production">Production</button>
      <button class="nav-item" data-page="weekly">Weekly Dashboard</button>
    </nav>

    <main class="app-main">
      <div class="message" id="message"></div>

      <!-- Dashboard -->
      <section class="page-section active" id="dashboardPage">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-value" id="totalReels">0</div>
            <div class="stat-label">Total Reels</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">‚è≥</div>
            <div class="stat-value" id="pendingReview">0</div>
            <div class="stat-label">Pending Review</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-value" id="approvedIdeas">0</div>
            <div class="stat-label">Approved Ideas</div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">üìÖ</div>
            <div class="stat-value" id="thisWeek">0</div>
            <div class="stat-label">This Week</div>
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn btn-primary" id="addNewResearch">
            <span>+</span>
            <span>Add Research</span>
          </button>
          <button class="btn btn-secondary" data-page="research">
            <span>üìã</span>
            <span>View All</span>
          </button>
        </div>

        <div class="activity-feed">
          <h2 class="section-title">
            <span>üìç</span>
            Recent Activity
          </h2>
          <div id="activityFeedContent">
            <p style="color: var(--text-tertiary); text-align: center; padding: 20px;">Loading activity...</p>
          </div>
        </div>
      </section>
      
      <!-- Research Collection Page -->
      <section class="page-section" id="researchPage">
        <h2 class="section-title">
          <span>üîç</span>
          Reel Research Collection
        </h2>

        <div class="research-form" id="researchForm" style="display: none;">
          <h3 style="font-size: 24px; margin-bottom: 32px; color: var(--text-primary); font-weight: 700;">
            Add New Reel Research
          </h3>
          
          <form id="addResearchForm">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Account Name <span style="color: #EF9A9A;">*</span></label>
                <input type="text" class="form-input" id="accountName" placeholder="@americanhairline" required>
              </div>
              
              <div class="form-group">
                <label class="form-label">Category <span style="color: #EF9A9A;">*</span></label>
                <select class="form-input" id="category" required>
                  <option value="">Select Category</option>
                  <option>Patch</option>
                  <option>Extensions</option>
                  <option>Personal Brand</option>
                  <option>Salon</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Source Type <span style="color: #EF9A9A;">*</span></label>
                <select class="form-input" id="sourceType" required>
                  <option value="">Select Source</option>
                  <option>Competitor</option>
                  <option>Influencer</option>
                  <option>Outlier</option>
                  <option>Trending/Meme</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Outlier Category <span style="color: #EF9A9A;">*</span></label>
                <select class="form-input" id="outlierCategory" required>
                  <option value="">Select Outlier</option>
                  <option>Hook</option>
                  <option>Topic</option>
                  <option>Music</option>
                  <option>Shooting Style</option>
                  <option>Script</option>
                  <option>Full Reel</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Shooting Style</label>
                <select class="form-input" id="shootingStyle">
                  <option value="">Select Style</option>
                  <option>Talk-to-camera</option>
                  <option>Before-after</option>
                  <option>Meme</option>
                  <option>Storytelling</option>
                  <option>Transformation</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Link to Reel <span style="color: #EF9A9A;">*</span></label>
                <input type="url" class="form-input" id="reelLink" placeholder="https://instagram.com/reel/..." required>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Hook / Opening Line</label>
                <input type="text" class="form-input" id="hook" placeholder="First 1-2 lines of the Reel">
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Topic / Subject</label>
                <input type="text" class="form-input" id="topic" placeholder="What the video is about">
              </div>
              
              <div class="form-group">
                <label class="form-label">Music / Audio Used</label>
                <input type="text" class="form-input" id="music" placeholder="Audio name or link">
              </div>
              
              <div class="form-group">
                <label class="form-label">Brolls / Text on Thumbnail</label>
                <input type="text" class="form-input" id="brolls" placeholder="Text overlays">
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Thumbnail Image</label>
                <div class="file-upload">
                  <label class="file-upload-label" for="thumbnailUpload">
                    <span class="file-upload-icon">üì∑</span>
                    <span class="file-upload-text">Click to upload thumbnail image</span>
                  </label>
                  <input type="file" id="thumbnailUpload" accept="image/*">
                </div>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Why It Outperformed</label>
                <textarea class="form-input" id="whyOutperformed" placeholder="Brief reason why it worked"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">How We Can Recreate It</label>
                <textarea class="form-input" id="howRecreate" placeholder="Actionable idea for your brand"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Notes / Tags</label>
                <input type="text" class="form-input" id="notes" placeholder="Props, outfit, tone, etc.">
              </div>
            </div>
            
            <div style="display: flex; gap: 16px; margin-top: 32px;">
              <button type="button" class="btn btn-secondary" id="cancelResearch">
                <span>√ó</span>
                <span>Cancel</span>
              </button>
              <button type="submit" class="btn btn-primary">
                <span>‚úì</span>
                <span>Save Research</span>
              </button>
            </div>
          </form>
        </div>

        <div class="table-container">
          <div class="table-controls">
            <h3 style="font-size: 18px; font-weight: 700; color: var(--text-primary);">
              Research Items (<span id="researchCount">0</span>)
            </h3>
            
            <div class="search-box">
              <span class="search-icon">üîç</span>
              <input type="text" class="form-input" id="searchResearch" placeholder="Search research...">
            </div>
            
            <div style="display: flex; gap: 12px;">
              <button class="btn-icon btn-refresh" id="refreshResearch" title="Refresh">
                üîÑ Refresh
              </button>
              <button class="btn btn-primary" id="toggleFormBtn">
                <span>+</span>
                <span>Add Research</span>
              </button>
            </div>
          </div>

          <div class="table-wrapper">
            <table id="researchTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Account</th>
                  <th>Category</th>
                  <th>Source</th>
                  <th>Outlier</th>
                  <th>Hook</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="researchTableBody"></tbody>
            </table>
          </div>

          <div class="empty-state" id="researchEmpty">
            <div class="empty-icon">üì¶</div>
            <h3 class="empty-title">No Research Items Yet</h3>
            <p class="empty-text">Click "Add Research" to start collecting viral reels</p>
          </div>
        </div>
      </section>

      <!-- Production Page -->
      <section class="page-section" id="productionPage">
        <h2 class="section-title">
          <span>‚ú®</span>
          Approved Outliers - Scripting & Production
        </h2>

        <!-- Production Form (Hidden by default) -->
        <div class="research-form" id="productionForm" style="display: none;">
          <h3 style="font-size: 26px; margin-bottom: 32px; color: var(--text-primary); font-weight: 700;">
            ‚úçÔ∏è Scriptwriting & Production Details
          </h3>
          
          <!-- Approved Research Details (Read-only) -->
          <div style="background: linear-gradient(135deg, rgba(157, 78, 221, 0.15), rgba(255, 107, 157, 0.15)); padding: 24px; border-radius: 16px; margin-bottom: 32px; border: 2px solid rgba(157, 78, 221, 0.3);">
            <h4 style="font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
              <span>üìã</span> Approved Research Details
            </h4>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Account Name</label>
                <input type="text" class="form-input" id="prodAccountName" readonly style="background: rgba(55, 45, 68, 0.6);">
              </div>
              
              <div class="form-group">
                <label class="form-label">Category</label>
                <input type="text" class="form-input" id="prodCategory" readonly style="background: rgba(55, 45, 68, 0.6);">
              </div>
              
              <div class="form-group">
                <label class="form-label">Outlier Type</label>
                <input type="text" class="form-input" id="prodOutlier" readonly style="background: rgba(55, 45, 68, 0.6);">
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Hook / Opening Line</label>
                <input type="text" class="form-input" id="prodHook" readonly style="background: rgba(55, 45, 68, 0.6);">
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Topic / Subject</label>
                <input type="text" class="form-input" id="prodTopic" readonly style="background: rgba(55, 45, 68, 0.6);">
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Why It Outperformed</label>
                <textarea class="form-input" id="prodWhy" readonly style="background: rgba(55, 45, 68, 0.6); min-height: 80px;"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Reference Link</label>
                <div style="display: flex; gap: 12px; align-items: center;">
                  <input type="url" class="form-input" id="prodLink" readonly style="background: rgba(55, 45, 68, 0.6); flex: 1;">
                  <button type="button" class="btn btn-secondary" id="openRefLink" style="white-space: nowrap;">
                    <span>üîó</span>
                    <span>Open Reel</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <form id="addProductionForm">
            <input type="hidden" id="productionItemId">
            <input type="hidden" id="productionResearchId">
            
            <!-- Script & Content Section -->
            <h4 style="font-size: 20px; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
              <span>üìù</span> Script & Content
            </h4>
            
            <div class="form-grid">
              <div class="form-group form-group-full">
                <label class="form-label">Main Script <span style="color: #EF9A9A;">*</span></label>
                <textarea class="form-input" id="mainScript" placeholder="Write the complete script here..." required style="min-height: 200px;"></textarea>
                <small style="color: var(--text-tertiary); font-size: 13px; margin-top: 4px; display: block;">Write the full script that will be spoken in the reel</small>
              </div>
              
              <div class="form-group">
                <label class="form-label">CTA (Call to Action) <span style="color: #EF9A9A;">*</span></label>
                <input type="text" class="form-input" id="cta" placeholder="e.g., Follow for more tips" required>
              </div>
              
              <div class="form-group">
                <label class="form-label">1st Frame Text <span style="color: #EF9A9A;">*</span></label>
                <input type="text" class="form-input" id="firstFrame" placeholder="Text that appears on first frame" required>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">B-Rolls Required</label>
                <textarea class="form-input" id="bRolls" placeholder="List all B-roll shots needed" style="min-height: 100px;"></textarea>
              </div>
              
              <div class="form-group">
                <label class="form-label">Text on Thumbnail</label>
                <input type="text" class="form-input" id="thumbnailText" placeholder="Text overlay for thumbnail">
              </div>
              
              <div class="form-group">
                <label class="form-label">Thumbnail Image</label>
                <div class="file-upload">
                  <label class="file-upload-label" for="thumbnailImageUpload">
                    <span class="file-upload-icon">üñºÔ∏è</span>
                    <span class="file-upload-text">Upload thumbnail image</span>
                  </label>
                  <input type="file" id="thumbnailImageUpload" accept="image/*">
                </div>
              </div>
            </div>
            
            <div style="height: 32px;"></div>
            
            <!-- Production Notes Section -->
            <h4 style="font-size: 20px; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
              <span>üé¨</span> Production Notes
            </h4>
            
            <div class="form-grid">
              <div class="form-group form-group-full">
                <label class="form-label">Prop / Setup Notes</label>
                <textarea class="form-input" id="propNotes" placeholder="Props needed, setup requirements, location, lighting, etc." style="min-height: 100px;"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Director Version / Notes</label>
                <textarea class="form-input" id="directorVersion" placeholder="Specific notes for the director about framing, camera angles, pacing, etc." style="min-height: 120px;"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Editor Version / Notes</label>
                <textarea class="form-input" id="editorVersion" placeholder="Editing notes: transitions, effects, music, pacing, text animations, etc." style="min-height: 120px;"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Speaker Version / Notes</label>
                <textarea class="form-input" id="speakerVersion" placeholder="Notes for the speaker: tone, emphasis, energy level, delivery style, etc." style="min-height: 120px;"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Additional Notes</label>
                <textarea class="form-input" id="prodNotes" placeholder="Any other important notes or considerations" style="min-height: 80px;"></textarea>
              </div>
            </div>
            
            <div style="height: 32px;"></div>
            
            <!-- Status & Approval Section -->
            <h4 style="font-size: 20px; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
              <span>‚úÖ</span> Status & Approval
            </h4>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Production Status <span style="color: #EF9A9A;">*</span></label>
                <select class="form-input" id="prodStatus" required>
                  <option value="">Select Status</option>
                  <option>Draft</option>
                  <option>Scripting</option>
                  <option>Ready to Film</option>
                  <option>Filming</option>
                  <option>Editing</option>
                  <option>Review</option>
                  <option>Ready to Publish</option>
                  <option>Published</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Approval Status <span style="color: #EF9A9A;">*</span></label>
                <select class="form-input" id="approvalStatus" required>
                  <option value="">Select Approval</option>
                  <option>Pending</option>
                  <option>Approved</option>
                  <option>Needs Revision</option>
                </select>
              </div>
            </div>
            
            <div style="display: flex; gap: 16px; margin-top: 32px;">
              <button type="button" class="btn btn-secondary" id="cancelProduction">
                <span>√ó</span>
                <span>Cancel</span>
              </button>
              <button type="submit" class="btn btn-primary">
                <span>‚úì</span>
                <span>Save Production Details</span>
              </button>
            </div>
          </form>
        </div>

        <!-- Production Table -->
        <div class="table-container">
          <div class="table-controls">
            <h3 style="font-size: 20px; font-weight: 700; color: var(--text-primary);">
              Production Items (<span id="productionCount">0</span>)
            </h3>
            
            <div style="display: flex; gap: 16px; flex-wrap: wrap; flex: 1; justify-content: center;">
              <select class="form-input" id="filterNiche" style="width: 180px;">
                <option value="">All Niches</option>
                <option>Patch</option>
                <option>Extensions</option>
                <option>Personal Brand</option>
                <option>Salon</option>
              </select>
              
              <select class="form-input" id="filterProductionStatus" style="width: 180px;">
                <option value="">All Status</option>
                <option>Draft</option>
                <option>Scripting</option>
                <option>Ready to Film</option>
                <option>Filming</option>
                <option>Editing</option>
                <option>Review</option>
                <option>Ready to Publish</option>
                <option>Published</option>
              </select>
            </div>
            
            <div style="display: flex; gap: 12px;">
              <button class="btn-icon btn-refresh" id="refreshProduction" title="Refresh">
                üîÑ Refresh
              </button>
              <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" class="form-input" id="searchProduction" placeholder="Search production...">
              </div>
            </div>
          </div>

          <div class="table-wrapper">
            <table id="productionTable">
              <thead>
                <tr>
                  <th>Date Added</th>
                  <th>Account</th>
                  <th>Category</th>
                  <th>Outlier</th>
                  <th>Hook</th>
                  <th>Script Status</th>
                  <th>Production Status</th>
                  <th>Approval</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="productionTableBody"></tbody>
            </table>
          </div>

          <div class="empty-state" id="productionEmpty">
            <div class="empty-icon">‚ú®</div>
            <h3 class="empty-title">No Production Items Yet</h3>
            <p class="empty-text">Approve research items to move them to production</p>
          </div>
        </div>
      </section>
      
      <!-- Weekly Dashboard Page -->
      <section class="page-section" id="weeklyPage">
        <h2 class="section-title">
          <span>üìä</span>
          Weekly Summary Dashboard
        </h2>
        
        <p style="color: var(--text-tertiary); margin-bottom: 32px; font-size: 14px; font-weight: 600;">
          Week of <span id="weekRange">Loading...</span>
        </p>

        <div class="dashboard-grid">
          <div class="dashboard-card">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 24px; color: var(--text-primary);">
              üìà Performance Metrics
            </h3>
            
            <div style="display: grid; gap: 16px;">
              <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(157, 78, 221, 0.15); border-radius: 12px;">
                <span style="color: var(--text-tertiary); font-size: 14px; font-weight: 600;">Total Entries This Week</span>
                <span style="font-weight: 700; color: var(--text-primary); font-size: 18px;" id="weeklyTotal">0</span>
              </div>
              
              <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(157, 78, 221, 0.15); border-radius: 12px;">
                <span style="color: var(--text-tertiary); font-size: 14px; font-weight: 600;">Approved Ideas</span>
                <span style="font-weight: 700; color: var(--text-primary); font-size: 18px;" id="weeklyApproved">0</span>
              </div>
              
              <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(157, 78, 221, 0.15); border-radius: 12px;">
                <span style="color: var(--text-tertiary); font-size: 14px; font-weight: 600;">In Production</span>
                <span style="font-weight: 700; color: var(--text-primary); font-size: 18px;" id="weeklyProduction">0</span>
              </div>
              
              <div style="display: flex; justify-content: space-between; padding: 12px; background: rgba(157, 78, 221, 0.15); border-radius: 12px;">
                <span style="color: var(--text-tertiary); font-size: 14px; font-weight: 600;">Top Contributor</span>
                <span style="font-weight: 700; color: var(--text-primary);" id="weeklyTopContributor">-</span>
              </div>
            </div>
          </div>

          <div class="dashboard-card">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 24px; color: var(--text-primary);">
              üìä Category Breakdown
            </h3>
            <div id="categoryBreakdown">
              <p style="color: var(--text-tertiary); text-align: center;">Loading...</p>
            </div>
          </div>

          <div class="dashboard-card">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 24px; color: var(--text-primary);">
              üî• Top Performing Hooks
            </h3>
            <ul class="top-list" id="topHooks">
              <li style="color: var(--text-tertiary); text-align: center; padding: 20px;">Loading...</li>
            </ul>
          </div>

          <div class="dashboard-card">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 24px; color: var(--text-primary);">
              üéØ Outlier Type Distribution
            </h3>
            <div id="outlierDistribution">
              <p style="color: var(--text-tertiary); text-align: center;">Loading...</p>
            </div>
          </div>
        </div>

        <div style="margin-top: 32px; text-align: center;">
          <button class="btn btn-primary" id="downloadReport">
            <span>üì•</span>
            <span>Download PDF Report</span>
          </button>
          <button class="btn btn-secondary" id="shareReport">
            <span>üì§</span>
            <span>Share Report</span>
          </button>
        </div>
      </section>
    </main>
  </div>

  <!-- Edit Research Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">‚úèÔ∏è Edit Research Entry</h2>
        <button class="btn-close" id="closeEditModal">√ó</button>
      </div>
      
      <div class="modal-body">
        <div class="tabs">
          <button class="tab active" data-tab="basic">Basic Info</button>
          <button class="tab" data-tab="details">Details</button>
          <button class="tab" data-tab="analysis">Analysis</button>
        </div>

        <form id="editResearchForm">
          <input type="hidden" id="editItemId">
          
          <div class="tab-content active" data-content="basic">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Account Name</label>
                <input type="text" class="form-input" id="editAccountName">
              </div>
              
              <div class="form-group">
                <label class="form-label">Category</label>
                <select class="form-input" id="editCategory">
                  <option>Patch</option>
                  <option>Extensions</option>
                  <option>Personal Brand</option>
                  <option>Salon</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Source Type</label>
                <select class="form-input" id="editSourceType">
                  <option>Competitor</option>
                  <option>Influencer</option>
                  <option>Outlier</option>
                  <option>Trending/Meme</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Outlier Category</label>
                <select class="form-input" id="editOutlierCategory">
                  <option>Hook</option>
                  <option>Topic</option>
                  <option>Music</option>
                  <option>Shooting Style</option>
                  <option>Script</option>
                  <option>Full Reel</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">Date Added</label>
                <input type="text" class="form-input" id="editDateAdded" readonly>
              </div>
              
              <div class="form-group">
                <label class="form-label">Added By</label>
                <input type="text" class="form-input" id="editAddedBy" readonly>
              </div>
            </div>
          </div>

          <div class="tab-content" data-content="details">
            <div class="form-grid">
              <div class="form-group form-group-full">
                <label class="form-label">Hook / Opening Line</label>
                <textarea class="form-input" id="editHook"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Topic / Subject</label>
                <textarea class="form-input" id="editTopic"></textarea>
              </div>
              
              <div class="form-group">
                <label class="form-label">Music / Audio</label>
                <input type="text" class="form-input" id="editMusic">
              </div>
              
              <div class="form-group">
                <label class="form-label">Brolls</label>
                <input type="text" class="form-input" id="editBrolls">
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Shooting Style</label>
                <select class="form-input" id="editShootingStyle">
                  <option>Talk-to-camera</option>
                  <option>Before-after</option>
                  <option>Meme</option>
                  <option>Storytelling</option>
                  <option>Transformation</option>
                </select>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Link to Reel</label>
                <input type="url" class="form-input" id="editReelLink">
              </div>
            </div>
          </div>

          <div class="tab-content" data-content="analysis">
            <div class="form-grid">
              <div class="form-group form-group-full">
                <label class="form-label">Why It Outperformed</label>
                <textarea class="form-input" id="editWhyOutperformed"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">How We Can Recreate It</label>
                <textarea class="form-input" id="editHowRecreate"></textarea>
              </div>
              
              <div class="form-group form-group-full">
                <label class="form-label">Notes / Tags</label>
                <input type="text" class="form-input" id="editNotes">
              </div>
              
              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-input" id="editStatus">
                  <option value="Pending">Pending Review</option>
                  <option value="Approved">Approved</option>
                  <option value="Rejected">Rejected</option>
                </select>
              </div>
            </div>
          </div>

          <div style="display: flex; gap: 16px; justify-content: flex-end; margin-top: 32px;">
            <button type="button" class="btn btn-secondary" id="cancelEdit">Cancel</button>
            <button type="submit" class="btn btn-primary">
              <span>‚úì</span>
              <span>Save Changes</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Production Modal -->
  <div class="modal" id="editProductionModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">‚úèÔ∏è Edit Production Item</h2>
        <button class="btn-close" id="closeEditProductionModal">√ó</button>
      </div>
      
      <div class="modal-body">
        <form id="editProductionForm">
          <input type="hidden" id="editProdId">
          <input type="hidden" id="editProdResearchId">
          
          <!-- Reference Info (Read-only) -->
          <div style="background: linear-gradient(135deg, rgba(157, 78, 221, 0.15), rgba(255, 107, 157, 0.15)); padding: 20px; border-radius: 12px; margin-bottom: 24px;">
            <h4 style="font-size: 16px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px;">
              üìã Reference Info
            </h4>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Account</label>
                <input type="text" class="form-input" id="editProdAccount" readonly style="background: rgba(55, 45, 68, 0.6);">
              </div>
              <div class="form-group">
                <label class="form-label">Category</label>
                <input type="text" class="form-input" id="editProdCategory" readonly style="background: rgba(55, 45, 68, 0.6);">
              </div>
              <div class="form-group form-group-full">
                <label class="form-label">Hook</label>
                <input type="text" class="form-input" id="editProdHook" readonly style="background: rgba(55, 45, 68, 0.6);">
              </div>
              <div class="form-group form-group-full">
                <label class="form-label">Reference Link</label>
                <div style="display: flex; gap: 12px;">
                  <input type="url" class="form-input" id="editProdLink" readonly style="background: rgba(55, 45, 68, 0.6); flex: 1;">
                  <button type="button" class="btn btn-secondary" id="editProdOpenLink">üîó Open</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Script & Content -->
          <h4 style="font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px;">
            üìù Script & Content
          </h4>
          <div class="form-grid">
            <div class="form-group form-group-full">
              <label class="form-label">Main Script</label>
              <textarea class="form-input" id="editProdScript" style="min-height: 150px;"></textarea>
            </div>
            
            <div class="form-group">
              <label class="form-label">CTA</label>
              <input type="text" class="form-input" id="editProdCTA">
            </div>
            
            <div class="form-group">
              <label class="form-label">1st Frame Text</label>
              <input type="text" class="form-input" id="editProdFirstFrame">
            </div>
            
            <div class="form-group form-group-full">
              <label class="form-label">B-Rolls</label>
              <textarea class="form-input" id="editProdBRolls"></textarea>
            </div>
            
            <div class="form-group">
              <label class="form-label">Thumbnail Text</label>
              <input type="text" class="form-input" id="editProdThumbnailText">
            </div>
          </div>
          
          <div style="height: 24px;"></div>
          
          <!-- Production Notes -->
          <h4 style="font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px;">
            üé¨ Production Notes
          </h4>
          <div class="form-grid">
            <div class="form-group form-group-full">
              <label class="form-label">Prop / Setup Notes</label>
              <textarea class="form-input" id="editProdPropNotes"></textarea>
            </div>
            
            <div class="form-group form-group-full">
              <label class="form-label">Director Version / Notes</label>
              <textarea class="form-input" id="editProdDirector"></textarea>
            </div>
            
            <div class="form-group form-group-full">
              <label class="form-label">Editor Version / Notes</label>
              <textarea class="form-input" id="editProdEditor"></textarea>
            </div>
            
            <div class="form-group form-group-full">
              <label class="form-label">Speaker Version / Notes</label>
              <textarea class="form-input" id="editProdSpeaker"></textarea>
            </div>
            
            <div class="form-group form-group-full">
              <label class="form-label">Additional Notes</label>
              <textarea class="form-input" id="editProdNotes"></textarea>
            </div>
          </div>
          
          <div style="height: 24px;"></div>
          
          <!-- Status & Approval -->
          <h4 style="font-size: 18px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px;">
            ‚úÖ Status & Approval
          </h4>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Production Status</label>
              <select class="form-input" id="editProdStatus">
                <option>Draft</option>
                <option>Scripting</option>
                <option>Ready to Film</option>
                <option>Filming</option>
                <option>Editing</option>
                <option>Review</option>
                <option>Ready to Publish</option>
                <option>Published</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Approval Status</label>
              <select class="form-input" id="editProdApproval">
                <option>Pending</option>
                <option>Approved</option>
                <option>Needs Revision</option>
              </select>
            </div>
          </div>

          <div style="display: flex; gap: 16px; justify-content: flex-end; margin-top: 32px;">
            <button type="button" class="btn btn-secondary" id="cancelEditProduction">Cancel</button>
            <button type="submit" class="btn btn-primary">
              <span>‚úì</span>
              <span>Save Changes</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  console.log('‚úÖ DOM fully loaded');

  let currentUser = null;
  let researchData = [];
  let productionData = [];

  // Auto-login check
  checkAutoLogin();

  // --- LOGIN HANDLERS ---
  const loginForm = document.getElementById('loginForm');
  const logoutBtn = document.getElementById('logoutBtn');

  if (loginForm) {
    loginForm.addEventListener('submit', async function (e) {
      e.preventDefault();
      const btn = document.getElementById('loginBtn');
      btn.disabled = true;
      btn.textContent = 'Logging in...';

      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const rememberMe = document.getElementById('rememberMe')?.checked;

      try {
        const result = await googleScriptRun('authenticateUser', username, password);

        if (result && result.success) {
          currentUser = result.user;
          if (rememberMe) {
            localStorage.setItem('rememberedUser', JSON.stringify({ username, password }));
          }
          showApp();
        } else {
          showMessage(result.message || 'Login failed', 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        showMessage('Error: ' + error, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Login';
      }
    });
  }

  if (logoutBtn) {
    logoutBtn.addEventListener('click', function () {
      currentUser = null;
      researchData = [];
      productionData = [];
      localStorage.removeItem('rememberedUser');
      document.getElementById('loginPage').style.display = 'flex';
      document.getElementById('appContainer').classList.remove('active');
      document.getElementById('loginForm').reset();
    });
  }

  // --- AUTO LOGIN ---
  function checkAutoLogin() {
    const remembered = localStorage.getItem('rememberedUser');
    if (remembered) {
      try {
        const userData = JSON.parse(remembered);
        googleScriptRun('authenticateUser', userData.username, userData.password)
          .then(result => {
            if (result && result.success) {
              currentUser = result.user;
              showApp();
            }
          })
          .catch(err => {
            console.error('Auto-login failed:', err);
            localStorage.removeItem('rememberedUser');
          });
      } catch (e) {
        console.error('Auto-login error:', e);
        localStorage.removeItem('rememberedUser');
      }
    }
  }

  // --- SHOW APP ---
  function showApp() {
    console.log('Showing app for user:', currentUser);
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('appContainer').classList.add('active');
    document.getElementById('userName').textContent = currentUser.name;
    document.getElementById('userAvatar').textContent = currentUser.avatar;

    setTimeout(() => {
      loadData();
    }, 200);
  }

  // --- LOAD ALL DATA ---
  async function loadData() {
    try {
      await loadStats();
      await loadResearch();
      await loadProduction();
      loadActivityFeed();
      console.log('All data loaded');
    } catch (error) {
      console.error('Error in loadData:', error);
      showMessage('Error loading data: ' + error.toString(), 'error');
    }
  }

  // --- LOAD STATS ---
  async function loadStats() {
    try {
      const result = await googleScriptRun('getStats');
      if (result && result.success) {
        document.getElementById('totalReels').textContent = result.stats.total || 0;
        document.getElementById('pendingReview').textContent = result.stats.pending || 0;
        document.getElementById('approvedIdeas').textContent = result.stats.approved || 0;
        document.getElementById('thisWeek').textContent = result.stats.thisWeek || 0;
      }
    } catch (error) {
      console.error('Error loading stats:', error);
    }
  }

  // --- LOAD RESEARCH ---
  async function loadResearch() {
    if (!currentUser?.name) {
      showMessage('Please login first', 'error');
      return;
    }

    try {
      const result = await googleScriptRun('getAllResearch', currentUser.name);
      if (!result || !result.success || !Array.isArray(result.data)) {
        throw new Error(result?.message || 'Failed to load research');
      }
      researchData = result.data;
      renderResearch();
      showMessage(`Loaded ${researchData.length} research items`, 'success');
    } catch (error) {
      console.error('Error loading research:', error);
      researchData = [];
      renderResearch();
      showMessage('Error loading research: ' + error.message, 'error');
    }
  }

  // --- RENDER RESEARCH TABLE ---
  function renderResearch() {
    const tbody = document.getElementById('researchTableBody');
    const empty = document.getElementById('researchEmpty');
    const count = document.getElementById('researchCount');
    const tableWrapper = document.querySelector('#researchPage .table-wrapper');
    if (!tbody) return;

    count.textContent = researchData?.length || 0;
    if (!researchData || researchData.length === 0) {
      tbody.innerHTML = '';
      if (empty) empty.style.display = 'block';
      if (tableWrapper) tableWrapper.style.display = 'none';
      return;
    }

    if (empty) empty.style.display = 'none';
    if (tableWrapper) tableWrapper.style.display = 'block';

    const safeStr = str =>
      str ? String(str).replace(/[<>&"']/g, c => ({ '<': '&lt;', '>': '&gt;', '&': '&amp;', '"': '&quot;', "'": '&#39;' }[c])) : '';

    let html = '';
    for (const item of researchData) {
      let date = 'N/A';
      if (item.dateAdded) {
        const d = new Date(item.dateAdded);
        if (!isNaN(d.getTime())) date = d.toLocaleDateString();
      }
      const outlierClass = (item.outlierCategory || '').toLowerCase().replace(/\s+/g, '').replace(/[^a-z0-9]/g, '');
      const statusClass = (item.status || 'pending').toLowerCase().replace(/\s+/g, '');

      html += `
        <tr data-outlier="${safeStr(item.outlierCategory)}">
          <td>${date}</td>
          <td>${safeStr(item.accountName) || 'N/A'}</td>
          <td>${safeStr(item.category) || 'N/A'}</td>
          <td>${safeStr(item.sourceType) || 'N/A'}</td>
          <td><span class="outlier-badge outlier-${outlierClass}">${safeStr(item.outlierCategory) || 'N/A'}</span></td>
          <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">
            ${safeStr(item.hook) || '-'}
          </td>
          <td><span class="status-badge status-${statusClass}">${safeStr(item.status) || 'Pending'}</span></td>
          <td style="white-space:nowrap;">
            <button class="btn-icon btn-view" onclick="viewResearchItem(${item.id})" title="View Reel">üëÅÔ∏è</button>
            <button class="btn-icon btn-edit" onclick="editItem(${item.id})" title="Edit">‚úèÔ∏è</button>
            <button class="btn-icon btn-delete" onclick="deleteItem(${item.id})" title="Delete">üóëÔ∏è</button>
          </td>
        </tr>`;
    }
    tbody.innerHTML = html;
  }

  // --- LOAD PRODUCTION ---
  async function loadProduction() {
    try {
      const result = await googleScriptRun('getAllProduction');
      if (result && result.success) {
        productionData = result.data || [];
        renderProduction();
      } else {
        productionData = [];
        renderProduction();
      }
    } catch (error) {
      console.error('Error loading production:', error);
      productionData = [];
      renderProduction();
    }
  }

  // --- RENDER PRODUCTION TABLE ---
  function renderProduction() {
    const tbody = document.getElementById('productionTableBody');
    const empty = document.getElementById('productionEmpty');
    const count = document.getElementById('productionCount');
    const tableWrapper = document.querySelector('#productionPage .table-wrapper');
    if (!tbody) return;

    count.textContent = productionData.length;
    if (productionData.length === 0) {
      tbody.innerHTML = '';
      if (empty) empty.style.display = 'block';
      if (tableWrapper) tableWrapper.style.display = 'none';
      return;
    }
    if (empty) empty.style.display = 'none';
    if (tableWrapper) tableWrapper.style.display = 'block';

    const safeStr = str =>
      str ? String(str).replace(/[<>&"']/g, c => ({ '<': '&lt;', '>': '&gt;', '&': '&amp;', '"': '&quot;', "'": '&#39;' }[c])) : '';

    tbody.innerHTML = productionData.map(item => {
      const outlierClass = (item.outlierCategory || '').toLowerCase().replace(/\s+/g, '').replace(/[^a-z0-9]/g, '');
      const prodStatusClass = (item.prodStatus || 'draft').toLowerCase().replace(/\s+/g, '');
      const approvalClass = (item.approvalStatus || 'pending').toLowerCase().replace(/\s+/g, '');
      const scriptStatus = item.mainScript ? 'Done' : 'Pending';
      const scriptClass = item.mainScript ? 'approved' : 'pending';
      
      return `
        <tr data-outlier="${safeStr(item.outlierCategory)}">
          <td>${item.dateAdded ? new Date(item.dateAdded).toLocaleDateString() : 'N/A'}</td>
          <td>${safeStr(item.accountName) || 'N/A'}</td>
          <td>${safeStr(item.category) || 'N/A'}</td>
          <td><span class="outlier-badge outlier-${outlierClass}">${safeStr(item.outlierCategory) || 'N/A'}</span></td>
          <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${safeStr(item.hook) || '-'}</td>
          <td><span class="status-badge status-${scriptClass}">${scriptStatus}</span></td>
          <td><span class="status-badge status-${prodStatusClass}">${safeStr(item.prodStatus) || 'Draft'}</span></td>
          <td><span class="status-badge status-${approvalClass}">${safeStr(item.approvalStatus) || 'Pending'}</span></td>
          <td style="white-space:nowrap;">
            <button class="btn-icon btn-view" onclick="viewProductionItem(${item.id})" title="View Reel">üëÅÔ∏è</button>
            <button class="btn-icon btn-edit" onclick="editProductionItem(${item.id})" title="Edit">‚úèÔ∏è</button>
            <button class="btn-icon btn-delete" onclick="deleteProductionItem(${item.id})" title="Delete">üóëÔ∏è</button>
          </td>
        </tr>
      `;
    }).join('');
  }

  // --- LOAD ACTIVITY FEED ---
  function loadActivityFeed() {
    const content = document.getElementById('activityFeedContent');
    if (!content) return;
    
    if (researchData.length === 0) {
      content.innerHTML = '<p style="color: var(--text-tertiary); text-align: center; padding: 20px;">No activity yet</p>';
      return;
    }

    // Get last 5 items
    const recent = [...researchData].sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded)).slice(0, 5);
    
    content.innerHTML = recent.map(item => {
      const time = getTimeAgo(new Date(item.dateAdded));
      const icon = getActivityIcon(item.outlierCategory);
      return `
        <div class="activity-item">
          <div class="activity-icon">${icon}</div>
          <div class="activity-content">
            <div class="activity-text">${item.addedBy} added ${item.outlierCategory} outlier from ${item.accountName}</div>
            <div class="activity-time">${time}</div>
          </div>
        </div>
      `;
    }).join('');
  }

  function getTimeAgo(date) {
    const seconds = Math.floor((new Date() - date) / 1000);
    const intervals = {
      year: 31536000,
      month: 2592000,
      week: 604800,
      day: 86400,
      hour: 3600,
      minute: 60
    };
    
    for (const [name, value] of Object.entries(intervals)) {
      const interval = Math.floor(seconds / value);
      if (interval >= 1) {
        return interval === 1 ? `1 ${name} ago` : `${interval} ${name}s ago`;
      }
    }
    return 'Just now';
  }

  function getActivityIcon(outlierCategory) {
    const icons = {
      'Hook': 'üéÄ',
      'Music': 'üéµ',
      'Script': 'üìù',
      'Shooting Style': 'üé¨',
      'Full Reel': 'üé•',
      'Topic': 'üí°'
    };
    return icons[outlierCategory] || 'üìå';
  }

  // --- RESEARCH FORM HANDLERS ---
  const addNewResearch = document.getElementById('addNewResearch');
  if (addNewResearch) {
    addNewResearch.addEventListener('click', function () {
      switchPage('research');
      document.getElementById('researchForm').style.display = 'block';
      document.getElementById('researchForm').scrollIntoView({ behavior: 'smooth' });
    });
  }

  document.getElementById('toggleFormBtn')?.addEventListener('click', function () {
    const form = document.getElementById('researchForm');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
    if (form.style.display === 'block') form.scrollIntoView({ behavior: 'smooth' });
  });

  document.getElementById('cancelResearch')?.addEventListener('click', function () {
    document.getElementById('researchForm').style.display = 'none';
    document.getElementById('addResearchForm').reset();
  });

  document.getElementById('addResearchForm')?.addEventListener('submit', async function (e) {
    e.preventDefault();
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span>‚è≥</span><span>Saving...</span>';

    const data = {
      addedBy: currentUser.name,
      accountName: document.getElementById('accountName').value,
      category: document.getElementById('category').value,
      sourceType: document.getElementById('sourceType').value,
      outlierCategory: document.getElementById('outlierCategory').value,
      hook: document.getElementById('hook').value,
      topic: document.getElementById('topic').value,
      music: document.getElementById('music').value,
      brolls: document.getElementById('brolls').value,
      shootingStyle: document.getElementById('shootingStyle').value,
      whyOutperformed: document.getElementById('whyOutperformed').value,
      howRecreate: document.getElementById('howRecreate').value,
      reelLink: document.getElementById('reelLink').value,
      notes: document.getElementById('notes').value
    };

    try {
      const result = await googleScriptRun('addResearch', data);
      if (result && result.success) {
        showMessage('Research added successfully! üéâ', 'success');
        document.getElementById('researchForm').style.display = 'none';
        document.getElementById('addResearchForm').reset();
        setTimeout(loadData, 800);
      } else {
        showMessage(result.message || 'Error adding research', 'error');
      }
    } catch (error) {
      console.error('Submit error:', error);
      showMessage('Error: ' + error.toString(), 'error');
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
    }
  });

  // --- EDIT RESEARCH ---
  window.editItem = function (id) {
    const item = researchData.find(i => i.id == id);
    if (!item) return showMessage('Item not found', 'error');
    
    document.getElementById('editItemId').value = item.id;
    document.getElementById('editAccountName').value = item.accountName || '';
    document.getElementById('editCategory').value = item.category || '';
    document.getElementById('editSourceType').value = item.sourceType || '';
    document.getElementById('editOutlierCategory').value = item.outlierCategory || '';
    document.getElementById('editDateAdded').value = item.dateAdded ? new Date(item.dateAdded).toLocaleString() : '';
    document.getElementById('editAddedBy').value = item.addedBy || '';
    document.getElementById('editHook').value = item.hook || '';
    document.getElementById('editTopic').value = item.topic || '';
    document.getElementById('editMusic').value = item.music || '';
    document.getElementById('editBrolls').value = item.brolls || '';
    document.getElementById('editShootingStyle').value = item.shootingStyle || '';
    document.getElementById('editReelLink').value = item.reelLink || '';
    document.getElementById('editWhyOutperformed').value = item.whyOutperformed || '';
    document.getElementById('editHowRecreate').value = item.howRecreate || '';
    document.getElementById('editNotes').value = item.notes || '';
    document.getElementById('editStatus').value = item.status || 'Pending';
    
    document.getElementById('editModal').classList.add('active');
    document.body.style.overflow = 'hidden';
  };

  document.getElementById('editResearchForm')?.addEventListener('submit', async function (e) {
    e.preventDefault();
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span>‚è≥</span><span>Saving...</span>';

    const data = {
      id: parseInt(document.getElementById('editItemId').value),
      accountName: document.getElementById('editAccountName').value,
      category: document.getElementById('editCategory').value,
      sourceType: document.getElementById('editSourceType').value,
      outlierCategory: document.getElementById('editOutlierCategory').value,
      hook: document.getElementById('editHook').value,
      topic: document.getElementById('editTopic').value,
      music: document.getElementById('editMusic').value,
      brolls: document.getElementById('editBrolls').value,
      shootingStyle: document.getElementById('editShootingStyle').value,
      whyOutperformed: document.getElementById('editWhyOutperformed').value,
      howRecreate: document.getElementById('editHowRecreate').value,
      reelLink: document.getElementById('editReelLink').value,
      notes: document.getElementById('editNotes').value,
      status: document.getElementById('editStatus').value
    };

    try {
      const result = await googleScriptRun('updateResearch', data);
      if (result && result.success) {
        showMessage('Research updated successfully!', 'success');
        closeEditModal();
        setTimeout(loadData, 800);
      } else {
        showMessage(result.message || 'Error updating research', 'error');
      }
    } catch (error) {
      console.error('Update error:', error);
      showMessage('Error: ' + error.toString(), 'error');
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
    }
  });

  // --- DELETE RESEARCH ---
  window.deleteItem = async function (id) {
    if (!confirm('Are you sure you want to delete this item?')) return;
    try {
      const result = await googleScriptRun('deleteResearch', id, currentUser.name);
      if (result && result.success) {
        showMessage('Deleted successfully', 'success');
        setTimeout(loadData, 800);
      } else showMessage(result.message || 'Error deleting', 'error');
    } catch (error) {
      showMessage('Error: ' + error.toString(), 'error');
    }
  };

  // --- VIEW RESEARCH ITEM ---
  window.viewResearchItem = function (id) {
    const item = researchData.find(i => i.id == id);
    if (item && item.reelLink) {
      window.open(item.reelLink, '_blank');
    } else {
      showMessage('No link available', 'info');
    }
  };

  // --- PRODUCTION FORM HANDLERS ---
  document.getElementById('cancelProduction')?.addEventListener('click', function () {
    document.getElementById('productionForm').style.display = 'none';
    document.getElementById('addProductionForm').reset();
  });

  document.getElementById('openRefLink')?.addEventListener('click', function () {
    const link = document.getElementById('prodLink').value;
    if (link) window.open(link, '_blank');
  });

  document.getElementById('addProductionForm')?.addEventListener('submit', async function (e) {
    e.preventDefault();
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span>‚è≥</span><span>Saving...</span>';

    const data = {
      id: parseInt(document.getElementById('productionItemId').value),
      mainScript: document.getElementById('mainScript').value,
      cta: document.getElementById('cta').value,
      firstFrame: document.getElementById('firstFrame').value,
      bRolls: document.getElementById('bRolls').value,
      thumbnailText: document.getElementById('thumbnailText').value,
      propNotes: document.getElementById('propNotes').value,
      directorVersion: document.getElementById('directorVersion').value,
      editorVersion: document.getElementById('editorVersion').value,
      speakerVersion: document.getElementById('speakerVersion').value,
      notes: document.getElementById('prodNotes').value,
      prodStatus: document.getElementById('prodStatus').value,
      approvalStatus: document.getElementById('approvalStatus').value
    };

    try {
      const result = await googleScriptRun('updateProduction', data);
      if (result && result.success) {
        showMessage('Production details saved successfully! üé¨', 'success');
        document.getElementById('productionForm').style.display = 'none';
        document.getElementById('addProductionForm').reset();
        setTimeout(loadData, 800);
      } else {
        showMessage(result.message || 'Error saving production', 'error');
      }
    } catch (error) {
      console.error('Production submit error:', error);
      showMessage('Error: ' + error.toString(), 'error');
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
    }
  });

  // --- EDIT PRODUCTION ---
  window.editProductionItem = function (id) {
    const item = productionData.find(i => i.id == id);
    if (!item) return showMessage('Production item not found', 'error');

    // Fill reference info (readonly)
    document.getElementById('editProdId').value = item.id;
    document.getElementById('editProdResearchId').value = item.researchId || '';
    document.getElementById('editProdAccount').value = item.accountName || '';
    document.getElementById('editProdCategory').value = item.category || '';
    document.getElementById('editProdHook').value = item.hook || '';
    document.getElementById('editProdLink').value = item.reelLink || '';

    // Fill editable fields
    document.getElementById('editProdScript').value = item.mainScript || '';
    document.getElementById('editProdCTA').value = item.cta || '';
    document.getElementById('editProdFirstFrame').value = item.firstFrame || '';
    document.getElementById('editProdBRolls').value = item.bRolls || '';
    document.getElementById('editProdThumbnailText').value = item.thumbnailText || '';
    document.getElementById('editProdPropNotes').value = item.propNotes || '';
    document.getElementById('editProdDirector').value = item.directorVersion || '';
    document.getElementById('editProdEditor').value = item.editorVersion || '';
    document.getElementById('editProdSpeaker').value = item.speakerVersion || '';
    document.getElementById('editProdNotes').value = item.notes || '';
    document.getElementById('editProdStatus').value = item.prodStatus || 'Draft';
    document.getElementById('editProdApproval').value = item.approvalStatus || 'Pending';

    document.getElementById('editProductionModal').classList.add('active');
    document.body.style.overflow = 'hidden';
  };

  document.getElementById('editProdOpenLink')?.addEventListener('click', function () {
    const link = document.getElementById('editProdLink').value;
    if (link) window.open(link, '_blank');
  });

  document.getElementById('editProductionForm')?.addEventListener('submit', async function (e) {
    e.preventDefault();
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span>‚è≥</span><span>Saving...</span>';

    const data = {
      id: parseInt(document.getElementById('editProdId').value),
      mainScript: document.getElementById('editProdScript').value,
      cta: document.getElementById('editProdCTA').value,
      firstFrame: document.getElementById('editProdFirstFrame').value,
      bRolls: document.getElementById('editProdBRolls').value,
      thumbnailText: document.getElementById('editProdThumbnailText').value,
      propNotes: document.getElementById('editProdPropNotes').value,
      directorVersion: document.getElementById('editProdDirector').value,
      editorVersion: document.getElementById('editProdEditor').value,
      speakerVersion: document.getElementById('editProdSpeaker').value,
      notes: document.getElementById('editProdNotes').value,
      prodStatus: document.getElementById('editProdStatus').value,
      approvalStatus: document.getElementById('editProdApproval').value
    };

    try {
      const result = await googleScriptRun('updateProduction', data);
      if (result && result.success) {
        showMessage('Production updated successfully!', 'success');
        closeEditProductionModal();
        setTimeout(loadData, 800);
      } else {
        showMessage(result.message || 'Error updating production', 'error');
      }
    } catch (error) {
      console.error('Update error:', error);
      showMessage('Error: ' + error.toString(), 'error');
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
    }
  });

  // --- VIEW PRODUCTION ITEM ---
  window.viewProductionItem = function (id) {
    const item = productionData.find(i => i.id == id);
    if (item && item.reelLink) {
      window.open(item.reelLink, '_blank');
    } else {
      showMessage('No link available', 'info');
    }
  };

  // --- DELETE PRODUCTION ---
  window.deleteProductionItem = async function (id) {
    if (!confirm('Are you sure you want to delete this production item?')) return;
    try {
      const result = await googleScriptRun('deleteProduction', id);
      if (result && result.success) {
        showMessage('Production item deleted successfully', 'success');
        setTimeout(loadData, 800);
      } else {
        showMessage(result.message || 'Error deleting production item', 'error');
      }
    } catch (error) {
      showMessage('Error: ' + error.toString(), 'error');
    }
  };

  // --- MODAL HANDLERS ---
  function closeEditModal() {
    document.getElementById('editModal').classList.remove('active');
    document.body.style.overflow = '';
  }

  function closeEditProductionModal() {
    document.getElementById('editProductionModal').classList.remove('active');
    document.body.style.overflow = '';
  }

  document.getElementById('closeEditModal')?.addEventListener('click', closeEditModal);
  document.getElementById('cancelEdit')?.addEventListener('click', closeEditModal);
  document.getElementById('editModal')?.addEventListener('click', function (e) {
    if (e.target === this) closeEditModal();
  });

  document.getElementById('closeEditProductionModal')?.addEventListener('click', closeEditProductionModal);
  document.getElementById('cancelEditProduction')?.addEventListener('click', closeEditProductionModal);
  document.getElementById('editProductionModal')?.addEventListener('click', function (e) {
    if (e.target === this) closeEditProductionModal();
  });

  // --- TAB SWITCHING ---
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', function () {
      const parent = this.closest('.modal-body') || this.closest('.page-section');
      const tabName = this.dataset.tab;

      parent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');

      parent.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      parent.querySelector(`.tab-content[data-content="${tabName}"]`)?.classList.add('active');
    });
  });

  // --- SEARCH HANDLERS ---
  document.getElementById('searchResearch')?.addEventListener('input', function (e) {
    const query = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#researchTableBody tr');
    rows.forEach(row => {
      row.style.display = row.textContent.toLowerCase().includes(query) ? '' : 'none';
    });
  });

  document.getElementById('searchProduction')?.addEventListener('input', function (e) {
    const query = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#productionTableBody tr');
    rows.forEach(row => {
      row.style.display = row.textContent.toLowerCase().includes(query) ? '' : 'none';
    });
  });

  // --- REFRESH BUTTONS ---
  document.getElementById('refreshResearch')?.addEventListener('click', async function () {
    const btn = this;
    btn.disabled = true;
    btn.textContent = 'üîÑ Loading...';
    try {
      await loadResearch();
      showMessage('Research data refreshed!', 'success');
    } catch (error) {
      showMessage('Error refreshing: ' + error.toString(), 'error');
    } finally {
      btn.disabled = false;
      btn.innerHTML = 'üîÑ Refresh';
    }
  });

  document.getElementById('refreshProduction')?.addEventListener('click', async function () {
    const btn = this;
    btn.disabled = true;
    btn.textContent = 'üîÑ Loading...';
    try {
      await loadProduction();
      showMessage('Production data refreshed!', 'success');
    } catch (error) {
      showMessage('Error refreshing: ' + error.toString(), 'error');
    } finally {
      btn.disabled = false;
      btn.innerHTML = 'üîÑ Refresh';
    }
  });

  // --- NAVIGATION ---
  document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', function () {
      switchPage(this.dataset.page);
    });
  });

  document.querySelectorAll('.btn[data-page]').forEach(btn => {
    btn.addEventListener('click', function () {
      switchPage(this.dataset.page);
    });
  });

  function switchPage(pageName) {
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    document.querySelector(`.nav-item[data-page="${pageName}"]`)?.classList.add('active');
    
    document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
    document.getElementById(`${pageName}Page`)?.classList.add('active');

    // Load data when switching to production page
    if (pageName === 'production') {
      loadProduction();
    }
  }

  // --- GOOGLE SCRIPT WRAPPER ---
  function googleScriptRun(functionName, ...args) {
    return new Promise((resolve, reject) => {
      try {
        google.script.run
          .withSuccessHandler(resolve)
          .withFailureHandler(reject)
          [functionName](...args);
      } catch (e) {
        reject(e);
      }
    });
  }

  // --- SHOW MESSAGE ---
  function showMessage(text, type) {
    const message = document.getElementById('message');
    if (!message) return;
    message.textContent = text;
    message.className = `message ${type} active`;
    setTimeout(() => message.classList.remove('active'), 5000);
  }
});
</script>

</body>
</html>
